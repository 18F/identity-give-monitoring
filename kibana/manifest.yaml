---
applications:
- name: kibana
  processes:
  - type: web
    health-check-type: process
    memory: ((MEMORY))
    disk_quota: 4GB
    instances: ((INSTANCES))
    buildpacks:
      - https://github.com/cloudfoundry/apt-buildpack
      - binary_buildpack
    command: /home/vcap/deps/0/apt/usr/share/kibana/bin/kibana --config config/kibana.yml
    routes:
      - route: identity-idva-monitoring-kibana-((ENVIRONMENT_NAME)).apps.internal
    env:
      ENVIRONMENT_NAME: ((ENVIRONMENT_NAME))
  - type: worker
    instances: 0
    buildpacks:
      - python_buildpack
    no-route: true
    command: |
      python3 idvametrics/analytics_script.py \
        --host https://identity-idva-es-proxy-((ENVIRONMENT_NAME)).apps.internal \
        --port 61443
        --flow_id ((FLOW_ID))
        --username ((USERNAME))
        --password ((PASSWORD))
        --login_url https://idva-api-((ENVIRONMENT_NAME)).app.cloud.gov/v1/customers/login
        --base_url https://idva-api-((ENVIRONMENT_NAME)).app.cloud.gov/v1/flows
